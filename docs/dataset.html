---

title: Dataset


keywords: fastai
sidebar: home_sidebar



nb_path: "nbs/02_dataset.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/02_dataset.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>There are three main Dataset classes in the <code>timm</code> library:</p>
<ol>
<li><code>ImageDataset</code></li>
<li><code>IterableImageDataset</code></li>
<li><code>AugMixDataset</code></li>
</ol>
<p>In this piece of documentation, we will be looking at each one of them individually and also looking at various use cases for these Dataset classes.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="ImageDataset">ImageDataset<a class="anchor-link" href="#ImageDataset"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ImageDataset</span><span class="p">(</span><span class="n">root</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">parser</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ParserImageInTar</span><span class="p">,</span> <span class="n">ParserImageFolder</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">class_map</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">load_bytes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">transform</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</pre></div>
<p>The <code>ImageDataset</code> can be used to create both training and validation datasets is very similar to <a href="https://pytorch.org/docs/stable/torchvision/datasets.html#imagefolder">torchvision.datasets.ImageFolder</a> in it's functionality with some nice addons.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Parser">Parser<a class="anchor-link" href="#Parser"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <code>parser</code> is set automatically using a <code>create_parser</code> factory method. The <code>parser</code> finds all images and targets in <code>root</code> where the <code>root</code> folder is structured like so:</p>
<div class="highlight"><pre><span></span>root/dog/xxx.png
root/dog/xxy.png
root/dog/xxz.png

root/cat/123.png
root/cat/nsdf3.png
root/cat/asd932_.png
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <code>parser</code> sets a <code>class_to_idx</code> dictionary mapping from the classes to integers which looks something like:</p>
<div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;dog&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;cat&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="o">..</span><span class="p">}</span>
</pre></div>
<p>And also has an attribute called <code>samples</code> which is a List of Tuples that looks something like:</p>
<div class="highlight"><pre><span></span><span class="p">[(</span><span class="s1">&#39;root/dog/xxx.png&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;root/dog/xxy.png&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="o">...</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;root/cat/123.png&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;root/cat/nsdf3.png&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="o">...</span><span class="p">]</span>
</pre></div>
<p>This <code>parser</code> object is subscriptable and on doing something like <code>parser[index]</code> it returns a sample at that particular index in <code>self.samples</code>. Therefore, doing something like <code>parser[0]</code> would return <code>('root/dog/xxx.png', 0)</code>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="__getitem__(index:-int)-&#8594;-Tuple[Any,-Any]"><code>__getitem__(index: int) &#8594; Tuple[Any, Any]</code><a class="anchor-link" href="#__getitem__(index:-int)-&#8594;-Tuple[Any,-Any]"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Once the <code>parser</code> is set, then the <code>ImageDataset</code> get's an image, target from this <code>parser</code> based on the <code>index</code>.</p>
<div class="highlight"><pre><span></span><span class="n">img</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</pre></div>
<p>It then reads the image either as a <code>PIL.Image</code> and converts to <code>RGB</code> or reads the image as bytes depending on the <code>load_bytes</code> argument.</p>
<p>Finally, it transforms the image and returns the target. A dummy target <code>torch.tensor(-1)</code> is returned in case target is None.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Usage">Usage<a class="anchor-link" href="#Usage"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This <code>ImageDataset</code> can also be used as a replacement for <code>torchvision.datasets.ImageFolder</code>. Considering we have the <code>imagenette2-320</code> dataset present whose structure looks like:</p>

<pre><code>imagenette2-320
├── train
│   ├── n01440764
│   ├── n02102040
│   ├── n02979186
│   ├── n03000684
│   ├── n03028079
│   ├── n03394916
│   ├── n03417042
│   ├── n03425413
│   ├── n03445777
│   └── n03888257
└── val
    ├── n01440764
    ├── n02102040
    ├── n02979186
    ├── n03000684
    ├── n03028079
    ├── n03394916
    ├── n03417042
    ├── n03425413
    ├── n03445777
    └── n03888257</code></pre>
<p>And each subfolder contains a set of <code>.JPEG</code> files belonging to that class.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="c1"># run only once</span>
wget https://s3.amazonaws.com/fast-ai-imageclas/imagenette2-320.tgz
gunzip imagenette2-320.tgz
tar -xvf imagenette2-320.tar
</pre></div>
<p>Then, it is possible to create an <code>ImageDataset</code> like so:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">timm.data.dataset</span> <span class="kn">import</span> <span class="n">ImageDataset</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="n">ImageDataset</span><span class="p">(</span><span class="s1">&#39;./imagenette2-320&#39;</span><span class="p">)</span>
<span class="n">dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="p">(</span><span class="o">&lt;</span><span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span> <span class="n">image</span> <span class="n">mode</span><span class="o">=</span><span class="n">RGB</span> <span class="n">size</span><span class="o">=</span><span class="mi">426</span><span class="n">x320</span> <span class="n">at</span> <span class="mh">0x7FF7F4880460</span><span class="o">&gt;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
<p>We can also see the <code>dataset.parser</code> is an instance of <code>ParserImageFolder</code>:</p>
<div class="highlight"><pre><span></span><span class="n">dataset</span><span class="o">.</span><span class="n">parser</span>

<span class="o">&lt;</span><span class="n">timm</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">parsers</span><span class="o">.</span><span class="n">parser_image_folder</span><span class="o">.</span><span class="n">ParserImageFolder</span> <span class="n">at</span> <span class="mh">0x7ff7f4880d90</span><span class="o">&gt;</span>
</pre></div>
<p>Finally, let's have a look at the <code>class_to_idx</code> Dictionary mapping in parser:</p>
<div class="highlight"><pre><span></span><span class="n">dataset</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">class_to_idx</span>

<span class="p">{</span><span class="s1">&#39;n01440764&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
 <span class="s1">&#39;n02102040&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
 <span class="s1">&#39;n02979186&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
 <span class="s1">&#39;n03000684&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
 <span class="s1">&#39;n03028079&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
 <span class="s1">&#39;n03394916&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
 <span class="s1">&#39;n03417042&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
 <span class="s1">&#39;n03425413&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
 <span class="s1">&#39;n03445777&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
 <span class="s1">&#39;n03888257&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">}</span>
</pre></div>
<p>And, also, the first five samples like so:</p>
<div class="highlight"><pre><span></span><span class="n">dataset</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">samples</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>

<span class="p">[(</span><span class="s1">&#39;./imagenette2-320/train/n01440764/ILSVRC2012_val_00000293.JPEG&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;./imagenette2-320/train/n01440764/ILSVRC2012_val_00002138.JPEG&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;./imagenette2-320/train/n01440764/ILSVRC2012_val_00003014.JPEG&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;./imagenette2-320/train/n01440764/ILSVRC2012_val_00006697.JPEG&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;./imagenette2-320/train/n01440764/ILSVRC2012_val_00007197.JPEG&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="IterableImageDataset">IterableImageDataset<a class="anchor-link" href="#IterableImageDataset"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>timm</code> also provides an <code>IterableImageDataset</code> similar to PyTorch's <a href="https://pytorch.org/docs/stable/data.html#torch.utils.data.IterableDataset">IterableDataset</a> but, with a key difference - the <code>IterableImageDataset</code> applies the transforms to <code>image</code> before it yields an image and a target.</p>
<blockquote><p>Such form of datasets are particularly useful when data come from a stream or when the length of the data is unknown.</p>
</blockquote>
<p><code>timm</code> applies the transforms lazily to the <code>image</code> and also sets the target to a dummy target <code>torch.tensor(-1, dtype=torch.long)</code> in case the target is <code>None</code>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Similar to the <code>ImageDataset</code> above, the <code>IterableImageDataset</code> first creates a parser which gets a tuple of samples based on the <code>root</code> directory.</p>
<p>As explained before, the parser returns an image and the target is the corresponding folder in which the image exists.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include note.html content='The <code>IterableImageDataset</code> does not have a <code>__getitem__</code> method defined therefore it is not subscriptable. Doing something like <code>dataset[0]</code> where the <code>dataset</code> is an instance of <code>IterableImageDataset</code> would return an error. ' %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="__iter__"><code>__iter__</code><a class="anchor-link" href="#__iter__"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <code>__iter__</code> method inside <code>IterableImageDataset</code> first gets an image and a target from <code>self.parser</code> and then lazily applies the transforms to the image. Also, sets the target as a dummy value before both are returned.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Usage">Usage<a class="anchor-link" href="#Usage"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">timm.data</span> <span class="kn">import</span> <span class="n">IterableImageDataset</span>
<span class="kn">from</span> <span class="nn">timm.data.parsers.parser_image_folder</span> <span class="kn">import</span> <span class="n">ParserImageFolder</span>
<span class="kn">from</span> <span class="nn">timm.data.transforms_factory</span> <span class="kn">import</span> <span class="n">create_transform</span> 

<span class="n">root</span> <span class="o">=</span> <span class="s1">&#39;../../imagenette2-320/&#39;</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">ParserImageFolder</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
<span class="n">iterable_dataset</span> <span class="o">=</span> <span class="n">IterableImageDataset</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="n">root</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="n">parser</span><span class="p">)</span>
<span class="n">parser</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">iterable_dataset</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>((&lt;_io.BufferedReader name=&#39;../../imagenette2-320/train/n01440764/ILSVRC2012_val_00000293.JPEG&#39;&gt;,
  0),
 (&lt;_io.BufferedReader name=&#39;../../imagenette2-320/train/n01440764/ILSVRC2012_val_00000293.JPEG&#39;&gt;,
  0))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <code>iterable_dataset</code> is not Subscriptable.</p>
<div class="highlight"><pre><span></span><span class="n">iterable_dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="o">&gt;</span> <span class="o">&gt;</span> 
<span class="o">---------------------------------------------------------------------------</span>
<span class="ne">NotImplementedError</span>                       <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">14</span><span class="o">-</span><span class="mi">9085</span><span class="n">b17eda0c</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">iterable_dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="o">~/</span><span class="n">opt</span><span class="o">/</span><span class="n">anaconda3</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.8</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">torch</span><span class="o">/</span><span class="n">utils</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">dataset</span><span class="o">.</span><span class="n">py</span> <span class="ow">in</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
     <span class="mi">30</span> 
     <span class="mi">31</span>     <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T_co</span><span class="p">:</span><span class="o">---&gt;</span> <span class="mi">32</span>         <span class="k">raise</span> <span class="ne">NotImplementedError</span>     <span class="mi">33</span> 
     <span class="mi">34</span>     <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s1">&#39;Dataset[T_co]&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ConcatDataset[T_co]&#39;</span><span class="p">:</span>

<span class="ne">NotImplementedError</span><span class="p">:</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="AugmixDataset">AugmixDataset<a class="anchor-link" href="#AugmixDataset"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AugmixDataset</span><span class="p">(</span><span class="n">dataset</span><span class="p">:</span> <span class="n">ImageDataset</span><span class="p">,</span> <span class="n">num_splits</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">):</span>
</pre></div>
<p>The <code>AugmixDataset</code> accepts an <code>ImageDataset</code> and converts it to an Augmix Dataset.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>What's an Augmix Dataset and when would we need to do this?</strong></p>
<p>Let's answer that with the help of the Augmix paper.</p>
<p>{% include image.html alt="Augmix" width="500" max-width="500" file="/timmdocs/images/augmix.png" %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As can be seen in the image above, the final <code>Loss Output</code> is actually the sum of classificaiton loss and <code>λ</code> times Jensen-Shannon loss between labels and model predictions on X<sub>orig</sub>, X<sub>augmix1</sub> and X<sub>augmix2</sub>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Thus, for such a case, we would require three versions of the batch - original, augmix1 and augmix2. So how we do achieve this? Using <code>AugmixDataset</code> ofcourse! 
{% include note.html content='<code>augmix1</code> and <code>augmix2</code> are the augmented versions of the original batch where the augmentations are chosen randomly from a list of Operations. ' %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="__getitem__(index:-int)--&gt;-Tuple[Any,-Any]"><code>__getitem__(index: int) -&gt; Tuple[Any, Any]</code><a class="anchor-link" href="#__getitem__(index:-int)--&gt;-Tuple[Any,-Any]"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>First, we get an <code>X</code> and corresponding label <code>y</code> from the <code>self.dataset</code> which is the dataset passed into the <code>AugmixDataset</code> constructor. Next, we normalize this image <code>X</code> and add it to a variable called <code>x_list</code>.</p>
<p>Next, based on the <code>num_splits</code> argument which defaults to 0, we apply <code>augmentations</code> to <code>X</code>, normalize the augmented output and append it to <code>x_list</code>. 
{% include note.html content='If <code>num_splits=2</code>, then <code>x_list</code> has two items - <code>original + augmented</code>. If <code>num_splits=3</code>, then <code>x_list</code> has three items - <code>original + augmented1 + augmented2</code>. And so on..' %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Usage">Usage<a class="anchor-link" href="#Usage"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">timm.data</span> <span class="kn">import</span> <span class="n">ImageDataset</span><span class="p">,</span> <span class="n">IterableImageDataset</span><span class="p">,</span> <span class="n">AugMixDataset</span><span class="p">,</span> <span class="n">create_loader</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="n">ImageDataset</span><span class="p">(</span><span class="s1">&#39;../../imagenette2-320/&#39;</span><span class="p">)</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">AugMixDataset</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">num_splits</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">loader_train</span> <span class="o">=</span> <span class="n">create_loader</span><span class="p">(</span>
    <span class="n">dataset</span><span class="p">,</span> 
    <span class="n">input_size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">224</span><span class="p">),</span> 
    <span class="n">batch_size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> 
    <span class="n">is_training</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
    <span class="n">scale</span><span class="o">=</span><span class="p">[</span><span class="mf">0.08</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> 
    <span class="n">ratio</span><span class="o">=</span><span class="p">[</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">1.33</span><span class="p">],</span> 
    <span class="n">num_aug_splits</span><span class="o">=</span><span class="mi">2</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="c1"># Requires GPU to work</span>

<span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">loader_train</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>

<span class="o">&gt;&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">224</span><span class="p">])</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include note.html content='Now at this stage, you might ask - we passed in <code>batch_size=8</code>, but the batch size returned by <code>loader_train</code> is 16? Why would that be?' %}
Because we passed in <code>num_aug_splits=2</code>. In this case, the <code>loader_train</code> has the first 8 original images and next 8 images that represent <code>augmix1</code>.</p>
<p>Had we passed in <code>num_aug_splits=3</code>, then the effective <code>batch_size</code> would have been 24, where the first 8 images would have been the original images, next 8 representing <code>augmix1</code> and the last 8 representing <code>augmix2</code>.</p>

</div>
</div>
</div>
</div>
 

