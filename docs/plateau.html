---

title: PlateauLRScheduler


keywords: fastai
sidebar: home_sidebar



nb_path: "nbs/07e_plateau.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/07e_plateau.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this tutorial we are going to be looking at the <code>PlateauLRScheduler</code> in the <code>timm</code> library.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">timm.scheduler.plateau_lr</span> <span class="kn">import</span> <span class="n">PlateauLRScheduler</span>
<span class="kn">from</span> <span class="nn">nbdev.showdoc</span> <span class="kn">import</span> <span class="n">show_doc</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="PlateauLRScheduler" class="doc_header"><code>class</code> <code>PlateauLRScheduler</code><a href="timm/scheduler/plateau_lr.py#L12" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>PlateauLRScheduler</code>(<strong><code>optimizer</code></strong>, <strong><code>decay_rate</code></strong>=<em><code>0.1</code></em>, <strong><code>patience_t</code></strong>=<em><code>10</code></em>, <strong><code>verbose</code></strong>=<em><code>True</code></em>, <strong><code>threshold</code></strong>=<em><code>0.0001</code></em>, <strong><code>cooldown_t</code></strong>=<em><code>0</code></em>, <strong><code>warmup_t</code></strong>=<em><code>0</code></em>, <strong><code>warmup_lr_init</code></strong>=<em><code>0</code></em>, <strong><code>lr_min</code></strong>=<em><code>0</code></em>, <strong><code>mode</code></strong>=<em><code>'max'</code></em>, <strong><code>noise_range_t</code></strong>=<em><code>None</code></em>, <strong><code>noise_type</code></strong>=<em><code>'normal'</code></em>, <strong><code>noise_pct</code></strong>=<em><code>0.67</code></em>, <strong><code>noise_std</code></strong>=<em><code>1.0</code></em>, <strong><code>noise_seed</code></strong>=<em><code>None</code></em>, <strong><code>initialize</code></strong>=<em><code>True</code></em>) :: <code>Scheduler</code></p>
</blockquote>
<p>Decay the LR by a factor every time the validation loss plateaus.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <code>PlateauLRScheduler</code> as shown above accepts an <code>optimizer</code> and also some hyperparams which we will look into in detail below. We will first see how we can train models using the <code>PlateauLRScheduler</code> by first using <code>timm</code> training docs and then look at how we can use this scheduler as standalone scheduler for our custom training scripts.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Using-PlateauLRScheduler-scheduler-with-timm-training-script">Using <code>PlateauLRScheduler</code> scheduler with <code>timm</code> training script<a class="anchor-link" href="#Using-PlateauLRScheduler-scheduler-with-timm-training-script"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To train models using the <code>PlateauLRScheduler</code> we simply update the training script args passed by passing in <code>--sched plateau</code> parameter alongside the necessary hyperparams. In this section we will also look at how each of the hyperparams update the <code>plateau</code> scheduler.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The training command to use <code>cosine</code> scheduler looks something like:</p>
<div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">train</span><span class="o">.</span><span class="n">py</span> <span class="o">../</span><span class="n">imagenette2</span><span class="o">-</span><span class="mi">320</span><span class="o">/</span> <span class="o">--</span><span class="n">sched</span> <span class="n">plateau</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <code>PlateauLRScheduler</code> by default tracks the <code>eval-metric</code> which is by default <code>top-1</code> in the <code>timm</code> training script. If the performance plateaus, then the new learning learning after a certain number of epochs (by default 10) is set to <code>lr * decay_rate</code>. This scheduler underneath uses PyTorch's <a href="https://pytorch.org/docs/stable/_modules/torch/optim/lr_scheduler.html#ReduceLROnPlateau">ReduceLROnPlateau</a>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Args">Args<a class="anchor-link" href="#Args"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>All arguments passed to this scheduler are the same as PyTorch's <code>ReduceLROnPlateau</code> except they are renamed as follows:</p>
<table>
<thead><tr>
<th>TIMM</th>
<th>PyTorch</th>
</tr>
</thead>
<tbody>
<tr>
<td>patience_t</td>
<td>patience</td>
</tr>
<tr>
<td>decay_rate</td>
<td>factor</td>
</tr>
<tr>
<td>verbose</td>
<td>verbose</td>
</tr>
<tr>
<td>threshold</td>
<td>threshold</td>
</tr>
<tr>
<td>cooldown_t</td>
<td>cooldown</td>
</tr>
<tr>
<td>mode</td>
<td>mode</td>
</tr>
<tr>
<td>lr_min</td>
<td>min_lr</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The functionality is very similar to <a href="https://pytorch.org/docs/stable/_modules/torch/optim/lr_scheduler.html#ReduceLROnPlateau">ReduceLROnPlateau</a> except the addition of Noise.</p>

</div>
</div>
</div>
</div>
 

